local a=require("cc.expect")local b=require("ext.object")local c=require("am.ui.helpers")local d=require("am.core")local e=require("am.ui.const")local f={}local g=1;local h={}local i=b:extend("am.ui.b.BaseObject")f.BaseObject=i;function i:init()i.super.init(self,{})getmetatable(self).__tostring=nil;return self end;local j=i:extend("am.ui.b.UIBoundObject")f.UIBoundObject=j;function j:init(k,l)a.expect(1,k,"table")a.expect(2,l,"table")c.requireOutput(k)c.requireUIObject(l)j.super.init(self)self.output=k;self.obj=l;return self end;function j:validate()self.obj:validate(self.output)end;function j:render()self.obj:render(self.output)end;function j:handle(m,...)local m,n=d.cleanEventArgs(m,...)a.expect(1,m,"string")return self.obj:handle(self.output,{m,unpack(n)})end;local o=i:extend("am.ui.b.UIObject")f.UIObject=o;function o:init(p)p=p or{}o.super.init(self)a.field(p,"id","string","nil")if p.id==nil then p.id="ui"..tostring(g)g=g+1 end;if h[p.id]then error(p.id.." already exists")end;h[p.id]=true;self.id=p.id;self.visible=true;return self end;function o:validate(k)end;function o:render(k)a.expect(1,k,"table","nil")if k==nil then k=term end;c.requireOutput(k)self:validate(k)end;function o:handle(k,m,...)local m,n=d.cleanEventArgs(m,...)a.expect(1,k,"table")a.expect(2,m,"string")c.requireOutput(k)if m=="term_resize"or m=="monitor_resize"then self:render(k)end;return false end;function o:bind(k)a.expect(1,k,"table")return j(k,self)end;local q=i:extend("am.ui.b.ScreenPos")f.ScreenPos=q;function q:init(r,s)q.super.init(self)a.expect(1,r,"number")a.expect(2,s,"number")a.range(r,1)a.range(s,1)self.x=r;self.y=s;return self end;local t=i:extend("am.ui.FrameScreen")f.FrameScreen=t;function t:init(k,u,v,w,x,y,z,A,B)t.super.init(self)a.expect(1,k,"table")a.expect(2,u,"string")a.expect(3,v,"table")a.expect(4,w,"number")a.expect(5,x,"number")a.expect(6,y,"number","nil")a.expect(7,z,"number","nil")a.expect(8,A,"number")a.expect(9,B,"number")c.requireOutput(k)if not c.isPos(v)then error("basePos must be a ScreenPos")end;a.range(w,1)a.range(x,1)if y~=nil then a.range(y,1)end;if z~=nil then a.range(z,1)end;if A<0 then self.viewportStart=1;self.viewportEnd=x else self.viewportStart=1+A;self.viewportEnd=self.viewportStart+B-1 end;self.output=k;self.frameId=u;self.basePos=v;self.pos=f.ScreenPos(1,1)self.width=w;self.height=x;self.textColor=y;self.backgroundColor=z;self.currentScroll=A;return self end;function t:ccCompat()local C={}C._frameScreenRef=self;C.write=function(D)return self:write(D)end;C.clear=function()return self:clear()end;C.clearLine=function()return self:clearLine()end;C.getBackgroundColor=function()return self:getBackgroundColor()end;C.getBackgroundColour=function()return self:getBackgroundColor()end;C.getTextColor=function()return self:getTextColor()end;C.getTextColour=function()return self:getTextColor()end;C.getCursorBlink=function()return self:getCursorBlink()end;C.getSize=function()return self:getSize()end;C.getCursorPos=function()return self:getCursorPos()end;C.setBackgroundColor=function(E)return self:setBackgroundColor(E)end;C.setBackgroundColour=function(E)return self:setBackgroundColor(E)end;C.setTextColor=function(E)return self:setTextColor(E)end;C.setTextColour=function(E)return self:setTextColor(E)end;C.setCursorBlink=function(F)return self:setCursorBlink(F)end;C.setCursorPos=function(r,s)return self:setCursorPos(r,s)end;C.scroll=function(s)return self:scroll(s)end;C.isColor=function()return self:isColor()end;C.isColour=function()return self:isColor()end;C.blit=function(D,y,z)return self:blit(D,y,z)end;C.setPaletteColor=function(...)return self:setPaletteColor(...)end;C.setPaletteColour=function(...)return self:setPaletteColor(...)end;C.getPaletteColor=function(E)return self:getPaletteColor(E)end;C.getPaletteColour=function(E)return self:getPaletteColor(E)end;return C end;function t:addPadding(G,H,I,J)a.expect(1,G,"number")a.expect(2,H,"number")a.expect(3,I,"number")a.expect(4,J,"number")self.basePos.x=self.basePos.x+G;self.basePos.y=self.basePos.y+I;self.width=math.max(0,self.width-G-H)self.height=math.max(0,self.height-I-J)self.viewportEnd=self.viewportEnd-I-J end;function t:toAbsolutePos(r,s)local K=self.basePos.x+r-1;local L=self.basePos.y+s-1;if c.isFrameScreen(self.output)then return c.getFrameScreen(self.output):toAbsolutePos(K,L)end;return K,L end;function t:toRealtivePos(r,s)if c.isFrameScreen(self.output)then r,s=c.getFrameScreen(self.output):toRealtivePos(r,s)end;r=r-self.basePos.x+1;s=s-self.basePos.y+1;return r,s end;function t:write(D)if self.pos.y>self.height or self.pos.y<self.viewportStart or self.pos.y>self.viewportEnd then return end;if self.pos.x>self.width then return end;self.output.setBackgroundColor(self:getBackgroundColor())self.output.setTextColor(self:getTextColor())self:setCursorPos(self.pos.x,self.pos.y)for M=1,#D,1 do local N=D:sub(M,M)self.output.write(N)self.pos.x=self.pos.x+1;if self.pos.x>self.width then return end end end;function t:blit(D,y,z)local O=self:getBackgroundColor()local P=self:getTextColor()self:setBackgroundColor(z)self:setTextColor(y)self:write(D)self:setBackgroundColor(O)self:setTextColor(P)end;function t:clearLine()local Q=d.copy(self.pos)self:setBackgroundColor(self:getBackgroundColor())self:setCursorPos(1,Q.y)self:write(string.rep(" ",self.width))self:setCursorPos(Q.x,Q.y)end;function t:clear()local Q=d.copy(self.pos)self:setCursorPos(self.pos.x,self.viewportStart)for s=self.viewportStart,self.viewportEnd,1 do self:clearLine()self.pos.y=self.pos.y+1 end;self:setCursorPos(Q.x,Q.y)end;function t:getBackgroundColor()return c.getColor(self.backgroundColor,self.output.getBackgroundColor())end;function t:getTextColor()return c.getColor(self.textColor,self.output.getTextColor())end;function t:getCursorBlink()return self.output.getCursorBlink()end;function t:getSize()return self.width,self.height end;function t:getCursorPos()return self.pos.x,self.pos.y end;function t:setBackgroundColor(E)a.expect(1,E,"number")a.range(E,1)self.backgroundColor=E;self.output.setBackgroundColor(self.backgroundColor)end;function t:setTextColor(E)a.expect(1,E,"number")a.range(E,1)self.textColor=E;self.output.setTextColor(self.textColor)end;function t:setCursorBlink(F)a.expect(1,F,"bool")self.output.setCursorBlink(F)end;function t:setCursorPos(r,s)a.expect(1,r,"number")a.expect(2,s,"number")a.range(r,1)a.range(s,1)self.pos={x=r,y=s}if s<self.viewportStart or s>self.viewportEnd then return end;r=r-1;s=s-self.viewportStart;self.output.setCursorPos(self.basePos.x+r,self.basePos.y+s)end;function t:isColor()return self.output.isColor()end;function t:scroll(s)end;function t:setPaletteColor(...)self.output.setPaletteColor(...)end;function t:getPaletteColor(E)self.output.getPaletteColor(E)end;function t:getClickArea(r,s,G,H,I,J)local R=false;if r<1 then if r<1-G then return e.ClickArea.Border end;R=true elseif r>self.width then if r>self.width+H then return e.ClickArea.Border end;R=true end;if s<1 then if s<1-I then return e.ClickArea.Border end;R=true elseif s>self.height then if s>self.height+J then return e.ClickArea.Border end;R=true end;if R then return e.ClickArea.Padding end;return e.ClickArea.Screen end;return f
