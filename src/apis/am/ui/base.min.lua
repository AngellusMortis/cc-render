local a=require("cc.expect")local b=require("ext.object")local c=require("am.ui.helpers")local d=require("am.core")local e=require("am.ui.const")local f={}local g=1;local h={}local i=b:extend("am.ui.b.BaseObject")f.BaseObject=i;function i:init()i.super.init(self,{})getmetatable(self).__tostring=nil;return self end;local j=i:extend("am.ui.b.UIBoundObject")f.UIBoundObject=j;function j:init(k,l)a.expect(1,k,"table")a.expect(2,l,"table")c.requireOutput(k)c.requireUIObject(l)j.super.init(self)self.output=k;self.obj=l;return self end;function j:validate()self.obj:validate(self.output)end;function j:render()self.obj:render(self.output)end;function j:handle(m,...)local m,n=d.cleanEventArgs(m,...)a.expect(1,m,"string")return self.obj:handle(self.output,{m,unpack(n)})end;local o=i:extend("am.ui.b.UIObject")f.UIObject=o;function o:init(p)p=p or{}o.super.init(self)a.field(p,"id","string","nil")if p.id==nil then p.id="ui"..tostring(g)g=g+1 end;if h[p.id]then error(p.id.." already exists")end;h[p.id]=true;self.id=p.id;self.visible=true;return self end;function o:validate(k)end;function o:render(k)a.expect(1,k,"table","nil")if k==nil then k=term end;c.requireOutput(k)self:validate(k)end;function o:handle(k,m,...)local m,n=d.cleanEventArgs(m,...)a.expect(1,k,"table")a.expect(2,m,"string")c.requireOutput(k)if m=="term_resize"or m=="monitor_resize"then self:render(k)end;return false end;function o:bind(k)return j(k,self)end;local q=i:extend("am.ui.b.ScreenPos")f.ScreenPos=q;function q:init(r,s)q.super.init(self)a.expect(1,r,"number")a.expect(2,s,"number")a.range(r,1)a.range(s,1)self.x=r;self.y=s;return self end;local t=i:extend("am.ui.FrameScreen")f.FrameScreen=t;function t:init(k,u,v,w,x,y,z)t.super.init(self)a.expect(1,k,"table")a.expect(2,u,"string")a.expect(3,v,"table")a.expect(4,w,"number")a.expect(5,x,"number")a.expect(6,y,"number","nil")a.expect(7,z,"number","nil")c.requireOutput(k)if not c.isPos(v)then error("basePos must be a ScreenPos")end;a.range(w,1)a.range(x,1)if y~=nil then a.range(y,1)end;if z~=nil then a.range(z,1)end;self.output=k;self.frameId=u;self.basePos=v;self.pos=f.ScreenPos(1,1)self.width=w;self.height=x;self.textColor=y;self.backgroundColor=z;return self end;function t:ccCompat()local A={}A._frameScreenRef=self;A.write=function(B)return self:write(B)end;A.clear=function()return self:clear()end;A.clearLine=function()return self:clearLine()end;A.getBackgroundColor=function()return self:getBackgroundColor()end;A.getBackgroundColour=function()return self:getBackgroundColor()end;A.getTextColor=function()return self:getTextColor()end;A.getTextColour=function()return self:getTextColor()end;A.getCursorBlink=function()return self:getCursorBlink()end;A.getSize=function()return self:getSize()end;A.getCursorPos=function()return self:getCursorPos()end;A.setBackgroundColor=function(C)return self:setBackgroundColor(C)end;A.setBackgroundColour=function(C)return self:setBackgroundColor(C)end;A.setTextColor=function(C)return self:setTextColor(C)end;A.setTextColour=function(C)return self:setTextColor(C)end;A.setCursorBlink=function(D)return self:setCursorBlink(D)end;A.setCursorPos=function(r,s)return self:setCursorPos(r,s)end;A.scroll=function(s)return self:scroll(s)end;A.isColor=function()return self:isColor()end;A.isColour=function()return self:isColor()end;A.blit=function(B,y,z)return self:blit(B,y,z)end;A.setPaletteColor=function(...)return self:setPaletteColor(...)end;A.setPaletteColour=function(...)return self:setPaletteColor(...)end;A.getPaletteColor=function(C)return self:getPaletteColor(C)end;A.getPaletteColour=function(C)return self:getPaletteColor(C)end;return A end;function t:addPadding(E,F,G,H)a.expect(1,E,"number")a.expect(2,F,"number")a.expect(3,G,"number")a.expect(4,H,"number")self.basePos.x=self.basePos.x+E;self.basePos.y=self.basePos.y+G;self.width=math.max(0,self.width-E-F)self.height=math.max(0,self.height-G-H)end;function t:toAbsolutePos(r,s)local I=self.basePos.x+r-1;local J=self.basePos.y+s-1;if c.isFrameScreen(self.output)then return c.getFrameScreen(self.output):toAbsolutePos(I,J)end;return I,J end;function t:toRealtivePos(r,s)if c.isFrameScreen(self.output)then r,s=c.getFrameScreen(self.output):toRealtivePos(r,s)end;r=r-self.basePos.x+1;s=s-self.basePos.y+1;return r,s end;function t:write(B)if self.pos.y>self.height then return end;if self.pos.x>self.width then return end;self.output.setBackgroundColor(self:getBackgroundColor())self.output.setTextColor(self:getTextColor())self:setCursorPos(self.pos.x,self.pos.y)for K=1,#B,1 do local L=B:sub(K,K)if self.pos.x>self.width then return end;self.output.write(L)self.pos.x=self.pos.x+1 end end;function t:blit(B,y,z)local M=self:getBackgroundColor()local N=self:getTextColor()self:setBackgroundColor(z)self:setTextColor(y)self:write(B)self:setBackgroundColor(M)self:setTextColor(N)end;function t:clearLine()local O=d.copy(self.pos)self:setBackgroundColor(self:getBackgroundColor())self:setCursorPos(1,O.y)self:write(string.rep(" ",self.width))self:setCursorPos(O.x,O.y)end;function t:clear()local O=d.copy(self.pos)for s=1,self.height,1 do self:clearLine()self.pos.y=self.pos.y+1 end;self:setCursorPos(O.x,O.y)end;function t:getBackgroundColor()return c.getColor(self.backgroundColor,self.output.getBackgroundColor())end;function t:getTextColor()return c.getColor(self.textColor,self.output.getTextColor())end;function t:getCursorBlink()return self.output.getCursorBlink()end;function t:getSize()return self.width,self.height end;function t:getCursorPos()return self.pos.x,self.pos.y end;function t:setBackgroundColor(C)a.expect(1,C,"number")a.range(C,1)self.backgroundColor=C;self.output.setBackgroundColor(self.backgroundColor)end;function t:setTextColor(C)a.expect(1,C,"number")a.range(C,1)self.textColor=C;self.output.setTextColor(self.textColor)end;function t:setCursorBlink(D)a.expect(1,D,"bool")self.output.setCursorBlink(D)end;function t:setCursorPos(r,s)a.expect(1,r,"number")a.expect(2,s,"number")a.range(r,1,self.width)a.range(s,1,self.height)self.pos={x=r,y=s}r=r-1;s=s-1;self.output.setCursorPos(self.basePos.x+r,self.basePos.y+s)end;function t:isColor()return self.output.isColor()end;function t:scroll(s)error("Scrolling for Frame Not Supported")end;function t:setPaletteColor(...)self.output.setPaletteColor(...)end;function t:getPaletteColor(C)self.output.getPaletteColor(C)end;function t:getClickArea(r,s,E,F,G,H)local P=false;if r<1 then if r<1-E then return e.ClickArea.Border end;P=true elseif r>self.width then if r>self.width+F then return e.ClickArea.Border end;P=true end;if s<1 then if s<1-G then return e.ClickArea.Border end;P=true elseif s>self.height then if s>self.height+H then return e.ClickArea.Border end;P=true end;if P then return e.ClickArea.Padding end;return e.ClickArea.Screen end;return f
